{"componentChunkName":"component---src-templates-blog-post-js","path":"/use-varnish-with-nginx-and-ubuntu/","result":{"data":{"site":{"siteMetadata":{"title":"Stephen Quick"}},"markdownRemark":{"id":"ee017f3d-ecb7-5f7c-a5ed-ee58477039ab","excerpt":"Feels like I haven’t updated this blog in a while, so I’ll add a tutorial that I learned about a bit ago when trying to address speeds with Drupal. For starters…","html":"<p>Feels like I haven’t updated this blog in a while, so I’ll add a tutorial that I learned about a bit ago when trying to address speeds with Drupal.</p>\n<p>For starters this was done on an Ubuntu VM. From this <a href=\"https://www.varnish-cache.org/installation/ubuntu\">website</a>, follow the tutorial to install Varnish:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">apt-get install apt-transport-https\r\ncurl https://repo.varnish-cache.org/ubuntu/GPG-key.txt | apt-key add -\r\necho \"deb https://repo.varnish-cache.org/ubuntu/ precise varnish-4.0\" >> /etc/apt/sources.list.d/varnish-cache.list\r\napt-get update\r\napt-get install varnish</code></pre></div>\n<p>Edit this file:  <code class=\"language-text\">/etc/default/varnish</code>, under Alternative 2, configure the beginning port <code class=\"language-text\">:6082</code> to be <code class=\"language-text\">:80</code> like below:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">DAEMON_OPTS=\"-a :80 \\\r\n         -T localhost:6082 \\\r\n         -f /etc/varnish/default.vcl \\\r\n         -S /etc/varnish/secret \\\r\n         -s malloc,256m\"</code></pre></div>\n<p>Next edit the file located at <code class=\"language-text\">/etc/varnish/default.vcl</code>. Change to port to from <code class=\"language-text\">80</code> to <code class=\"language-text\">8080</code> like below:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">backend default {\r\n    .host = \"127.0.0.1\";\r\n    .port = \"8080\";\r\n    .connect_timeout = 60s;\r\n    .first_byte_timeout = 60s;\r\n    .between_bytes_timeout = 60s;\r\n    .max_connections = 800;\r\n}</code></pre></div>\n<p>Now the next step would be to edit the port used by nginx. Each server(it you have it configured that way) would need to be switched from <code class=\"language-text\">80</code> to <code class=\"language-text\">8080</code>. The location of my config files are <code class=\"language-text\">/etc/nginx/sites-available</code>.</p>\n<p>###Notes:</p>\n<p>If you’re using this on a vagrant and have ports forwarded, for example I use homestead for laravel, you will need to change the forwarded port from 8000 to 8080, otherwise it won’t work properly, and nginx will likely not show your sites.</p>\n<p>###Finished, now test:</p>\n<p>To test, you can run <code class=\"language-text\">varnishstat</code>, and that should give you data live as you access the domain affected by varnish.</p>","frontmatter":{"title":"Use Varnish with Nginx and Ubuntu","date":"January 27, 2015","description":null}},"previous":{"fields":{"slug":"/use-gulp-notify-with-terminal-notifier/"},"frontmatter":{"title":"Notifications Using Gulp-Notify on Vagrant with Terminal-Notifier"}},"next":{"fields":{"slug":"/migration-from-dreamhost-to-namecheap-and-github/"},"frontmatter":{"title":"Migration from Dreamhost to Namecheap and Github"}}},"pageContext":{"id":"ee017f3d-ecb7-5f7c-a5ed-ee58477039ab","previousPostId":"093020e0-5f01-5ff9-8297-09a00914f674","nextPostId":"6faa008f-b8a0-5b21-a5b4-cc1a305f2dde"}},"staticQueryHashes":["3000541721","3274528899"],"slicesMap":{}}